<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Meu Portafolis</title>
    
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'VT323', monospace, sans-serif; background-color: #008080; user-select: none; }
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        #menu-bar { position: fixed; top: 0; left: 0; width: 100%; height: 25px; background: #c0c0c0; border-bottom: 2px solid #808080; display: flex; align-items: center; padding: 0 10px; box-sizing: border-box; font-size: 18px; z-index: 10000; }
        #taskbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 35px; background: #c0c0c0; border-top: 2px solid #ffffff; display: flex; align-items: center; padding: 0 5px; box-sizing: border-box; z-index: 10000; }
        #start-button { font-weight: bold; padding: 2px 10px; border: 2px solid; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #808080; border-bottom-color: #808080; cursor: pointer; flex-shrink: 0; }
        #start-button:active { border-top-color: #808080; border-left-color: #808080; border-right-color: #ffffff; border-bottom-color: #ffffff; }
        #taskbar-windows { flex-grow: 1; height: 100%; display: flex; align-items: center; gap: 3px; padding: 0 5px; overflow: hidden; }
        .taskbar-tab { flex-grow: 1; flex-shrink: 1; min-width: 50px; max-width: 160px; padding: 2px 8px; border: 2px solid; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #808080; border-bottom-color: #808080; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 16px; text-align: left; }
        .taskbar-tab.active { border-top-color: #808080; border-left-color: #808080; border-right-color: #ffffff; border-bottom-color: #ffffff; background-color: #e0e0e0; }
        #clock { padding: 2px 10px; border: 2px inset #808080; flex-shrink: 0; }
        #desktop { width: 100%; height: 100%; position: relative; padding-top: 25px; padding-bottom: 35px; box-sizing: border-box; display: flex; align-items: flex-start; padding-left: 30px; }
        #desktop-icons { display: flex; flex-direction: column; gap: 20px; padding-top: 20px; }
        .icon { width: 90px; text-align: center; cursor: pointer; color: white; padding: 5px; }
        .icon:hover, .icon:focus { background-color: rgba(0, 0, 128, 0.5); border: 1px dotted white; }
        .icon img { width: 50px; height: 50px; }
        .icon span { display: block; margin-top: 5px; white-space: nowrap; }
        .window { position: absolute; background-color: #c0c0c0; border: 2px solid; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #808080; border-bottom-color: #808080; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); min-width: 350px; min-height: 250px; width: 600px; height: 450px; display: flex; flex-direction: column; }
        .window .title-bar { background-color: #000080; color: white; padding: 3px 5px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: move; height: 20px; }
        .title-bar-buttons { display: flex; }
        .title-bar-buttons button { background-color: #c0c0c0; border: 1px solid; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #808080; border-bottom-color: #808080; font-family: 'VT323', monospace; width: 16px; height: 14px; padding: 0; margin-left: 2px; cursor: pointer; display: flex; align-items: center; justify-content: center; line-height: 1; }
        .title-bar-buttons button.minimize-btn { padding-bottom: 4px; }
        .window .content { flex-grow: 1; background-color: white; margin: 3px; color: black; font-size: 18px; display: flex; flex-direction: column; overflow: hidden; }
        .resizer { position: absolute; } .resizer.n { top: -3px; left: 5px; right: 5px; height: 6px; cursor: n-resize; } .resizer.s { bottom: -3px; left: 5px; right: 5px; height: 6px; cursor: s-resize; } .resizer.e { top: 5px; bottom: 5px; right: -3px; width: 6px; cursor: e-resize; } .resizer.w { top: 5px; bottom: 5px; left: -3px; width: 6px; cursor: w-resize; } .resizer.ne { top: -3px; right: -3px; width: 8px; height: 8px; cursor: ne-resize; } .resizer.nw { top: -3px; left: -3px; width: 8px; height: 8px; cursor: nw-resize; } .resizer.se { bottom: -3px; right: -3px; width: 8px; height: 8px; cursor: se-resize; } .resizer.sw { bottom: -3px; left: -3px; width: 8px; height: 8px; cursor: sw-resize; }
        .window .content.folder-view { padding: 0; }
        .files-container { flex: 1; overflow-y: auto; display: flex; flex-wrap: wrap; align-content: flex-start; gap: 15px; padding: 25px 15px 15px 15px; }
        .file-card { background-color: #ffffff; cursor: pointer; overflow: hidden; border-radius: 4px; border: 1px solid #ddd; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.2s ease, box-shadow 0.2s ease; flex-grow: 1; flex-shrink: 0; flex-basis: 260px; max-width: 300px; }
        .file-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }
        .card-image { width: 100%; height: 120px; background-color: #e9ecef; background-size: cover; background-position: center; }
        .card-image-placeholder { display: flex; align-items: center; justify-content: center; font-size: 3em; color: #adb5bd; height: 100%; }
        .card-body { padding: 12px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #495057; }
        .card-body h4 { font-family: 'VT323', monospace, sans-serif; font-size: 20px; margin: 0 0 8px 0; color: #212529; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-body p { margin: 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }
        .search-bar-container { width: 100%; padding: 8px 10px; border-bottom: 2px solid #f0f0f0; box-sizing: border-box; background-color: #f8f9fa; display: flex; gap: 10px; align-items: center; }
        .search-input { flex-grow: 1; padding: 8px; font-size: 16px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        .sort-select { padding: 8px; font-size: 16px; border: 1px solid #ccc; border-radius: 4px; background-color: white; font-family: 'VT323', monospace, sans-serif; }
        .document-view, .project-view { padding: 30px 40px; font-family: "Georgia", "Times New Roman", Times, serif; line-height: 1.7; color: #333; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); overflow-y: auto; background-color: #fdfdfd; }
        .document-view *, .project-view * { max-width: 100%; }
        .document-view img, .project-view img { height: auto; border: 1px solid #ccc; padding: 3px; background: #fff; margin: 10px 0; }
        .document-view h1, .project-view h1 { font-family: 'VT323', monospace, sans-serif; font-size: 32px; margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid #ccc; color: #000; }
        .document-view p, .project-view p { white-space: normal; text-align: left; }
        .document-view a, .project-view a { color: #0056b3; text-decoration: none; border-bottom: 1px dotted #0056b3; }
        .document-view a:hover, .project-view a:hover { color: #007bff; border-bottom-style: solid; }
        .document-view .date { font-style: italic; color: #666; font-size: 0.9em; margin-bottom: 20px; display: block; text-align: right; }
        .document-view ul, .document-view ol, .project-view ul { padding-left: 40px; }
        .document-view li, .project-view li { margin-bottom: 10px; }
        .project-header { margin-bottom: 25px; }
        .project-header p { font-style: italic; color: #555; font-size: 1.1em; margin: 5px 0 15px 0; border-left: 3px solid #007bff; padding-left: 10px; }
        .project-header .btn-visit { display: inline-block; background-color: #007bff; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; border-bottom: none; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-weight: bold; transition: background-color 0.2s; }
        .project-header .btn-visit:hover { background-color: #0056b3; }
        .project-gallery { margin-bottom: 30px; }
        .gallery-main-image { width: 100%; height: auto; max-height: 400px; object-fit: contain; border: 1px solid #ddd; margin-bottom: 10px; background-color: #f8f9fa; }
        .gallery-thumbnails { display: flex; gap: 10px; flex-wrap: wrap; }
        .gallery-thumbnails img { width: 100px; height: 60px; object-fit: cover; cursor: pointer; border: 2px solid #ddd; opacity: 0.7; transition: opacity 0.2s, border-color 0.2s; }
        .gallery-thumbnails img:hover { opacity: 1; }
        .gallery-thumbnails img.active { border-color: #007bff; opacity: 1; }
        .project-section { margin-bottom: 30px; }
        .project-section h3 { font-family: 'VT323', monospace, sans-serif; font-size: 24px; border-bottom: 1px solid #eee; padding-bottom: 8px; color: #343a40; }
        .tech-tags { display: flex; flex-wrap: wrap; gap: 8px; padding-left: 0; list-style: none; }
        .tech-tags li { background-color: #e9ecef; color: #495057; padding: 5px 12px; border-radius: 15px; font-size: 0.9em; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .features-list { list-style: none; padding-left: 0; }
        .features-list li { padding: 8px 0 8px 25px; border-bottom: 1px solid #f0f0f0; position: relative; }
        .features-list li::before { content: '‚úì'; color: #28a745; font-weight: bold; position: absolute; left: 0; top: 8px; }
    </style>
</head>

<body>
    <div id="menu-bar"><span><b>El Meu Portafolis</b> v4.2</span></div>
    <div id="desktop">
        <div id="desktop-icons">
            <div class="icon" id="icon-readme" tabindex="0"><img src="file.png" alt="Arxiu Llegeix-me"><span>Llegeix-me.txt</span></div>
            <div class="icon" id="icon-projects" tabindex="0"><img src="carpeta.png" alt="Carpeta de Projectes"><span>Projectes</span></div>
            <div class="icon" id="icon-apps" tabindex="0"><img src="carpeta.png" alt="Carpeta d'Apps"><span>Apps</span></div>
            <div class="icon" id="icon-blog" tabindex="0"><img src="carpeta.png" alt="Arxiu de Bloc"><span>Bloc</span></div>
        </div>
    </div>
    <div id="taskbar">
        <div id="start-button">Inici</div>
        <div id="taskbar-windows"></div>
        <div id="clock"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let zIndexCounter = 10;
        const desktop = document.getElementById('desktop');
        let windowCascadeCount = 0;
        const folderPositions = {};
        let nextFolderPositionIndex = 0;
        const presetFolderPositions = [ { top: 40, left: 20 }, { top: 70, left: 180 }, { top: 100, left: 90 }];
        const windowStates = {};

        const welcomeContentHTML = `
            <h1>Benvingut/da al meu Portafolis Interactiu!</h1>
            <p>Hola! Soc <strong>[El Teu Nom]</strong>, un/a desenvolupador/a i entusiasta de la tecnologia amb ganes de crear experi√®ncies √∫niques.</p>
            <p>Aquesta web simula un escriptori d'un sistema operatiu cl√†ssic. Est√† dissenyada per ser una forma original i divertida de mostrar els meus treballs. Aqu√≠ tens una petita guia per comen√ßar a explorar:</p>
            <ul>
                <li><b>Navega per les carpetes:</b> Fes doble clic a les icones de l'escriptori ("Projectes", "Apps", "Bloc") per obrir-les i veure qu√® contenen.</li>
                <li><b>Descobreix els Projectes:</b> La secci√≥ de projectes t√© un disseny especial per mostrar cada treball de forma atractiva, amb galeria d'imatges, tecnologies i molt m√©s.</li>
                <li><b>Cerca Avan√ßada:</b> La cerca √©s potent i tolera errors tipogr√†fics. Prova d'escriure "Barceona" si un projecte cont√© "Barcelona"!</li>
                <li><b>Gestiona el teu espai:</b> Pots arrossegar, redimensionar i minimitzar les finestres per organitzar el teu escriptori.</li>
            </ul>
            <p>Espero que gaudeixis de l'experi√®ncia. Endavant, explora sense por!</p>
        `;

        const stripHtml = (html) => { let tmp = document.createElement("DIV"); tmp.innerHTML = html; return tmp.textContent || tmp.innerText || ""; }
        const getPluralType = (type) => type === 'blog' ? type : type + 's';
        const debounce = (func, delay) => { let timeout; return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; };

        const updateActiveState = (windowId) => {
            document.querySelectorAll('.window').forEach(win => win.classList.toggle('active', win.id === windowId));
            document.querySelectorAll('.taskbar-tab').forEach(tb => tb.classList.toggle('active', tb.dataset.windowId === windowId));
        };
        
        const createWindow = (id, title, contentHTML, options = {}) => {
            const existingWindow = document.getElementById(id);
            if (existingWindow) {
                existingWindow.style.display = 'flex';
                existingWindow.style.zIndex = zIndexCounter++;
                updateActiveState(id);
                return existingWindow;
            }
            const win = document.createElement('div');
            win.id = id; win.className = 'window';
            const winWidth = parseInt(options.width || '600px', 10);
            const winHeight = parseInt(options.height || '450px', 10);
            win.style.width = `${winWidth}px`; win.style.height = `${winHeight}px`;
            
            if (options.pos?.left && options.pos?.top) { win.style.left = options.pos.left; win.style.top = options.pos.top; }
            else if (options.isFolder) {
                let pos = folderPositions[id] || presetFolderPositions[nextFolderPositionIndex % presetFolderPositions.length];
                folderPositions[id] = pos; nextFolderPositionIndex++;
                const desktopWidth = desktop.offsetWidth, desktopHeight = desktop.offsetHeight;
                let finalLeft = pos.left, finalTop = pos.top;
                if (finalLeft + winWidth > desktopWidth) finalLeft = Math.max(10, desktopWidth - winWidth - 20);
                if (finalTop + winHeight > desktopHeight) finalTop = Math.max(10, desktopHeight - winHeight - 20);
                win.style.left = `${finalLeft}px`; win.style.top = `${finalTop}px`;
            } else {
                const offset = (windowCascadeCount++ % 10) * 30;
                let left = 40 + offset, top = 40 + offset;
                if (left + winWidth > desktop.offsetWidth) left = Math.max(10, desktop.offsetWidth - winWidth - 20);
                if (top + winHeight > desktop.offsetHeight) top = Math.max(10, desktop.offsetHeight - winHeight - 20);
                win.style.left = `${left}px`; win.style.top = `${top}px`;
            }

            win.style.zIndex = zIndexCounter++;
            win.innerHTML = `<div class="title-bar"><span class="title">${title}</span><div class="title-bar-buttons"><button class="minimize-btn">_</button><button class="close-btn">x</button></div></div><div class="content ${options.contentClass || ''}">${contentHTML}</div><div class="resizer n"></div><div class="resizer s"></div><div class="resizer e"></div><div class="resizer w"></div><div class="resizer ne"></div><div class="resizer nw"></div><div class="resizer se"></div><div class="resizer sw"></div>`;
            desktop.appendChild(win);
            
            const tab = document.createElement('div');
            tab.className = 'taskbar-tab'; tab.textContent = title; tab.dataset.windowId = id;
            document.getElementById('taskbar-windows').appendChild(tab);

            updateActiveState(id);
            makeDraggable(win); makeResizable(win);

            win.querySelector('.close-btn').addEventListener('click', () => { win.remove(); tab.remove(); if (options.type) delete windowStates[options.type]; });
            win.querySelector('.minimize-btn').addEventListener('click', () => { win.style.display = 'none'; tab.classList.remove('active'); });
            win.addEventListener('mousedown', () => { win.style.zIndex = zIndexCounter++; updateActiveState(id); });
            tab.addEventListener('click', () => {
                const isMinimized = win.style.display === 'none';
                const isActive = tab.classList.contains('active');
                if (isMinimized || !isActive) { win.style.display = 'flex'; win.style.zIndex = zIndexCounter++; updateActiveState(id); } 
                else { win.style.display = 'none'; tab.classList.remove('active'); }
            });
            
            if (options.isFolder) { win.querySelector('.files-container').addEventListener('dblclick', handleOpenFile); }
            return win;
        };
        
        const fetchWindowData = async (type) => {
            const state = windowStates[type];
            if (!state || state.isLoading || (state.currentPage > state.totalPages && state.totalPages !== 0)) return;
            state.isLoading = true;
            const pluralType = getPluralType(type);
            const url = `/api/public/data/${pluralType}?page=${state.currentPage}&q=${encodeURIComponent(state.query)}&sort=${state.sort}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Error de xarxa');
                const data = await response.json();
                renderWindowItems(type, data.items);
                state.totalPages = data.totalPages;
                state.currentPage++;
            } catch (error) {
                console.error("Error carregant dades:", error);
                const container = document.getElementById(`${type}-files-container`);
                if (container && state.currentPage === 1) container.innerHTML = '<p style="color:red; text-align:center; width:100%;">Error en carregar les dades.</p>';
            } finally { state.isLoading = false; }
        };

        const renderWindowItems = (type, items) => {
            const container = document.getElementById(`${type}-files-container`);
            if (!container) return;
            if (items.length === 0 && windowStates[type].currentPage === 1) {
                container.innerHTML = '<p style="text-align:center; width:100%; color:#666; padding-top: 20px;">No s\'han trobat resultats.</p>';
                return;
            }
            let filesHTML = '';
            items.forEach(item => {
                const snippet = stripHtml(item.description || '').substring(0, 100);
                const imageStyle = item.imageUrl ? `background-image: url('${item.imageUrl}')` : '';
                const imagePlaceholder = !item.imageUrl ? '<div class="card-image-placeholder">üñºÔ∏è</div>' : '';
                filesHTML += `<div class="file-card" data-type="${type}" data-id="${item.id}"><div class="card-image" style="${imageStyle}">${imagePlaceholder}</div><div class="card-body"><h4>${item.title}</h4><p>${snippet}...</p></div></div>`;
            });
            container.innerHTML += filesHTML;
        };

        const createFolderWindow = (type, windowTitle) => {
            const pluralType = getPluralType(type);
            const windowId = `window-${pluralType}`;
            if (document.getElementById(windowId)) { createWindow(windowId, windowTitle); return; }
            windowStates[type] = { currentPage: 1, totalPages: 1, isLoading: false, query: '', sort: 'newest' };
            const content = `<div class="search-bar-container"><input type="text" id="${type}-search-input" class="search-input" placeholder="Cerca..."><select id="${type}-sort-select" class="sort-select"><option value="relevance" disabled>Rellev√†ncia</option><option value="newest" selected>M√©s nou</option><option value="oldest">M√©s antic</option></select></div><div class="files-container" id="${type}-files-container"></div>`;
            
            // MIDA DE LES FINESTRES DE CARPETA AUGMENTADA
            const windowOptions = { isFolder: true, contentClass: 'folder-view', width: '920px', height: '650px', type: type };
            
            createWindow(windowId, windowTitle, content, windowOptions);
            const searchInput = document.getElementById(`${type}-search-input`);
            const sortSelect = document.getElementById(`${type}-sort-select`);
            const filesContainer = document.getElementById(`${type}-files-container`);
            const resetAndFetch = () => {
                const state = windowStates[type];
                state.currentPage = 1; state.totalPages = 1; filesContainer.innerHTML = ''; fetchWindowData(type);
            };
            const debouncedSearch = debounce(() => {
                const state = windowStates[type];
                state.query = searchInput.value;
                if (state.query) { state.sort = 'relevance'; sortSelect.value = 'relevance'; sortSelect.querySelector('option[value="relevance"]').disabled = false; }
                else { state.sort = 'newest'; sortSelect.value = 'newest'; sortSelect.querySelector('option[value="relevance"]').disabled = true; }
                resetAndFetch();
            }, 400);
            searchInput.addEventListener('input', debouncedSearch);
            sortSelect.addEventListener('change', () => { windowStates[type].sort = sortSelect.value; resetAndFetch(); });
            filesContainer.addEventListener('scroll', () => { if (filesContainer.scrollTop + filesContainer.clientHeight >= filesContainer.scrollHeight * 0.9) fetchWindowData(type); });
            fetchWindowData(type);
        };
        
        const handleOpenFile = async (event) => {
            const fileCard = event.target.closest('.file-card'); if (!fileCard) return;
            const { type, id } = fileCard.dataset;
            try {
                const response = await fetch(`/api/item/${type}/${id}`);
                const item = await response.json();
                if (!item) { console.error("No s'ha trobat l'element:", type, id); return; }

                let fileContentHTML = '', fileTitle = `${item.title}.txt`, windowOptions = {};

                if (type === 'project') {
                    const data = item.data || {};
                    const technologies = (data.technologies || []).map(tech => `<li>${tech}</li>`).join('');
                    const features = (data.features || []).map(feature => `<li>${feature}</li>`).join('');
                    const screenshots = data.screenshots || [];
                    const thumbnails = screenshots.map((src, index) => `<img src="${src}" class="thumb ${index === 0 ? 'active' : ''}" data-index="${index}">`).join('');
                    
                    fileContentHTML = `
                        <div class="project-header">
                            <h1>${item.title}</h1>
                            ${data.summary ? `<p>${data.summary}</p>` : ''}
                            ${item.url ? `<a href="${item.url}" target="_blank" class="btn-visit">Visitar Projecte &rarr;</a>` : ''}
                        </div>
                        ${screenshots.length > 0 ? `
                        <div class="project-gallery">
                            <img src="${screenshots[0]}" id="gallery-main-${id}" class="gallery-main-image">
                            <div class="gallery-thumbnails" id="gallery-thumbs-${id}">${thumbnails}</div>
                        </div>` : ''}
                        ${technologies ? `<div class="project-section"><h3>Tecnologies</h3><ul class="tech-tags">${technologies}</ul></div>` : ''}
                        ${features ? `<div class="project-section"><h3>Caracter√≠stiques Clau</h3><ul class="features-list">${features}</ul></div>` : ''}
                        ${data.description ? `<div class="project-section"><h3>Descripci√≥</h3>${data.description}</div>` : ''}
                    `;
                    // MIDA DE LA FINESTRA DE PROJECTE AUGMENTADA
                    windowOptions = { contentClass: 'project-view', width: '850px', height: '700px' };
                } else { // Per a Blog i Apps
                    fileContentHTML = type === 'blog'
                        ? `<h1>${item.title}</h1><div class="date">${new Date(item.date).toLocaleDateString()}</div>${item.content}`
                        : item.description;
                    // MIDA DE LES FINESTRES DE DOCUMENT (BLOG/APP) AUGMENTADA
                    windowOptions = { contentClass: 'document-view', width: '750px', height: '700px' };
                }
                const win = createWindow(`window-${type}-${id}`, fileTitle, fileContentHTML, windowOptions);

                if (type === 'project') {
                    const mainImage = win.querySelector(`#gallery-main-${id}`);
                    win.querySelector(`#gallery-thumbs-${id}`)?.addEventListener('click', e => {
                        if (e.target.classList.contains('thumb')) {
                            mainImage.src = e.target.src;
                            win.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
                            e.target.classList.add('active');
                        }
                    });
                }
            } catch(error) { console.error("No s'ha pogut obrir l'arxiu:", error); alert("Error: no s'ha pogut carregar el contingut d'aquest arxiu."); }
        };

        const makeDraggable = (element) => { let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0; const header = element.querySelector('.title-bar'); if (header) header.onmousedown = dragMouseDown; function dragMouseDown(e) { e.preventDefault(); pos3 = e.clientX; pos4 = e.clientY; document.onmouseup = closeDragElement; document.onmousemove = elementDrag; } function elementDrag(e) { e.preventDefault(); pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY; pos3 = e.clientX; pos4 = e.clientY; element.style.top = (element.offsetTop - pos2) + "px"; element.style.left = (element.offsetLeft - pos1) + "px"; } function closeDragElement() { document.onmouseup = null; document.onmousemove = null; } };
        const makeResizable = (element) => { const resizers = element.querySelectorAll('.resizer'); const minimum_size = 200; let original_width = 0, original_height = 0, original_x = 0, original_y = 0; let original_mouse_x = 0, original_mouse_y = 0; resizers.forEach(resizer => { resizer.addEventListener('mousedown', (e) => { e.preventDefault(); original_width = parseFloat(getComputedStyle(element, null).getPropertyValue('width').replace('px', '')); original_height = parseFloat(getComputedStyle(element, null).getPropertyValue('height').replace('px', '')); original_x = element.getBoundingClientRect().left; original_y = element.getBoundingClientRect().top; original_mouse_x = e.pageX; original_mouse_y = e.pageY; window.addEventListener('mousemove', resize); window.addEventListener('mouseup', stopResize); function resize(e) { if (resizer.classList.contains('se')) { const width = original_width + (e.pageX - original_mouse_x); const height = original_height + (e.pageY - original_mouse_y); if (width > minimum_size) element.style.width = width + 'px'; if (height > minimum_size) element.style.height = height + 'px'; } else if (resizer.classList.contains('sw')) { const height = original_height + (e.pageY - original_mouse_y); const width = original_width - (e.pageX - original_mouse_x); if (height > minimum_size) element.style.height = height + 'px'; if (width > minimum_size) { element.style.width = width + 'px'; element.style.left = original_x + (e.pageX - original_mouse_x) + 'px'; } } else if (resizer.classList.contains('ne')) { const width = original_width + (e.pageX - original_mouse_x); const height = original_height - (e.pageY - original_mouse_y); if (width > minimum_size) element.style.width = width + 'px'; if (height > minimum_size) { element.style.height = height + 'px'; element.style.top = original_y + (e.pageY - original_mouse_y) + 'px'; } } else if (resizer.classList.contains('nw')) { const width = original_width - (e.pageX - original_mouse_x); const height = original_height - (e.pageY - original_mouse_y); if (width > minimum_size) { element.style.width = width + 'px'; element.style.left = original_x + (e.pageX - original_mouse_x) + 'px'; } if (height > minimum_size) { element.style.height = height + 'px'; element.style.top = original_y + (e.pageY - original_mouse_y) + 'px'; } } else if (resizer.classList.contains('n')) { const height = original_height - (e.pageY - original_mouse_y); if (height > minimum_size) { element.style.height = height + 'px'; element.style.top = original_y + (e.pageY - original_mouse_y) + 'px'; } } else if (resizer.classList.contains('s')) { const height = original_height + (e.pageY - original_mouse_y); if (height > minimum_size) element.style.height = height + 'px'; } else if (resizer.classList.contains('e')) { const width = original_width + (e.pageX - original_mouse_x); if (width > minimum_size) element.style.width = width + 'px'; } else if (resizer.classList.contains('w')) { const width = original_width - (e.pageX - original_mouse_x); if (width > minimum_size) { element.style.width = width + 'px'; element.style.left = original_x + (e.pageX - original_mouse_x) + 'px'; } } } function stopResize() { window.removeEventListener('mousemove', resize); } }); }); }
        const updateClock = () => { const now = new Date(); const hours = String(now.getHours()).padStart(2, '0'); const minutes = String(now.getMinutes()).padStart(2, '0'); document.getElementById('clock').textContent = `${hours}:${minutes}`; }
        const showWelcomeWindow = () => {
            const desktopWidth = desktop.offsetWidth, desktopHeight = desktop.offsetHeight; let winWidth = 600, winHeight = 500;
            if (winWidth > desktopWidth - 40) winWidth = desktopWidth - 40; if (winHeight > desktopHeight - 40) winHeight = desktopHeight - 40;
            const centerLeft = (desktopWidth / 2) - (winWidth / 2), centerTop = (desktopHeight / 2) - (winHeight / 2);
            const options = { pos: {left: `${centerLeft}px`, top: `${centerTop}px`}, contentClass: 'document-view', width: `${winWidth}px`, height: `${winHeight}px` };
            createWindow('window-welcome', 'Benvinguda.txt', welcomeContentHTML, options);
        }
        
        document.getElementById('icon-projects').addEventListener('dblclick', () => createFolderWindow('project', 'Projectes'));
        document.getElementById('icon-apps').addEventListener('dblclick', () => createFolderWindow('app', 'Aplicacions'));
        document.getElementById('icon-blog').addEventListener('dblclick', () => createFolderWindow('blog', 'Bloc'));
        document.getElementById('icon-readme').addEventListener('dblclick', showWelcomeWindow);
        
        setInterval(updateClock, 1000); 
        updateClock();
        showWelcomeWindow();
    });
    </script>
</body>
</html>