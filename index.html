<!DOCTYPE html>
<html lang="ca">
    <style>
    .clippy, .clippy-balloon {
        position: fixed;
        z-index: 1000;
        cursor: pointer;
    }
    .clippy-balloon {
        background: #FFC;
        color: black;
        padding: 8px;
        border: 1px solid black;
        border-radius: 5px;
    }
    .clippy-content {
        max-width: 200px;
        min-width: 120px;
        font-family: "Microsoft Sans", sans-serif;
        font-size: 10pt;
    }
    .clippy-tip {
        width: 10px;
        height: 16px;
        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAMAAAAlvKiEAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAlQTFRF///MAAAA////52QwgAAAAAN0Uk5T//8A18oNQQAAAGxJREFUeNqs0kEOwCAIRFHn3//QTUU6xMyyxii+jQosrTPkyPEM6IN3FtzIRk1U4dFeKWQiH6pRRowMVKEmvronEynkwj0uZJgR22+YLopPSo9P34wJSamLSU7lSIWLJU7NkNomNlhqxUeAAQC+TQLZyEuJBwAAAABJRU5ErkJggg==) no-repeat;
        position: absolute;
    }
    .clippy-top-left .clippy-tip { top: 100%; margin-top: 0px; left: 100%; margin-left: -50px; }
    .clippy-top-right .clippy-tip { top: 100%; margin-top: 0px; left: 0; margin-left: 50px; background-position: -10px 0; }
    .clippy-bottom-right .clippy-tip { top: 0; margin-top: -16px; left: 0; margin-left: 50px; background-position: -10px -16px; }
    .clippy-bottom-left .clippy-tip { top: 0; margin-top: -16px; left: 100%; margin-left: -50px; background-position: 0px -16px; }
</style>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Meu Portafolis</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'VT323', monospace, sans-serif; background-color: #008080; user-select: none; }
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        #menu-bar { position: fixed; top: 0; left: 0; width: 100%; height: 25px; background: #c0c0c0; border-bottom: 2px solid #808080; display: flex; align-items: center; padding: 0 10px; box-sizing: border-box; font-size: 18px; z-index: 10000; }
        #taskbar { position: fixed; bottom: 0; left: 0; width: 100%; height: 35px; background: #c0c0c0; border-top: 2px solid #ffffff; display: flex; align-items: center; justify-content: space-between; padding: 0 5px; box-sizing: border-box; z-index: 10000; }
        #start-button { font-weight: bold; padding: 2px 10px; border: 2px solid; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #808080; border-bottom-color: #808080; cursor: pointer; }
        #start-button:active { border-top-color: #808080; border-left-color: #808080; border-right-color: #ffffff; border-bottom-color: #ffffff; }
        #clock { padding: 2px 10px; border: 2px inset #808080; }
        #desktop { width: 100%; height: 100%; position: relative; padding-top: 25px; padding-bottom: 35px; box-sizing: border-box; display: flex; align-items: flex-start; padding-left: 30px; }
        #desktop-icons { display: flex; flex-direction: column; gap: 20px; padding-top: 20px; }
        .icon { width: 90px; text-align: center; cursor: pointer; color: white; padding: 5px; }
        .icon:hover, .icon:focus { background-color: rgba(0, 0, 128, 0.5); border: 1px dotted white; }
        .icon img { width: 50px; height: 50px; }
        .icon span { display: block; margin-top: 5px; white-space: nowrap; }
        .window { position: absolute; background-color: #c0c0c0; border: 2px solid; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #808080; border-bottom-color: #808080; box-shadow: 2px 2px 5px rgba(0,0,0,0.5); min-width: 350px; min-height: 250px; width: 600px; height: 450px; display: flex; flex-direction: column; }
        .window .title-bar { background-color: #000080; color: white; padding: 3px 5px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: move; height: 20px; }
        .title-bar-buttons button { background-color: #c0c0c0; border: 1px solid; border-top-color: #ffffff; border-left-color: #ffffff; border-right-color: #808080; border-bottom-color: #808080; font-family: 'VT323', monospace; width: 16px; height: 14px; padding: 0; margin-left: 2px; cursor: pointer; }
        
        .window .content { 
            flex-grow: 1; 
            background-color: white; 
            margin: 3px; 
            color: black; 
            font-size: 18px; 
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .resizer { position: absolute; } .resizer.n { top: -3px; left: 5px; right: 5px; height: 6px; cursor: n-resize; } .resizer.s { bottom: -3px; left: 5px; right: 5px; height: 6px; cursor: s-resize; } .resizer.e { top: 5px; bottom: 5px; right: -3px; width: 6px; cursor: e-resize; } .resizer.w { top: 5px; bottom: 5px; left: -3px; width: 6px; cursor: w-resize; } .resizer.ne { top: -3px; right: -3px; width: 8px; height: 8px; cursor: ne-resize; } .resizer.nw { top: -3px; left: -3px; width: 8px; height: 8px; cursor: nw-resize; } .resizer.se { bottom: -3px; right: -3px; width: 8px; height: 8px; cursor: se-resize; } .resizer.sw { bottom: -3px; left: -3px; width: 8px; height: 8px; cursor: sw-resize; }
        .window .content.folder-view { padding: 0; }
        
        .files-container {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-wrap: wrap;
            align-content: flex-start;
            gap: 15px;
            padding: 15px;
        }
        
        .file-card {
            background-color: #ffffff;
            cursor: pointer;
            overflow: hidden;
            border-radius: 4px;
            border: 1px solid #ddd;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            
            /* <<<< LA NOVA REGLA D'OR >>>> */
            flex-grow: 1;         /* Permet créixer per omplir espai */
            flex-shrink: 0;       /* PROHIBIT ENCONGIR-SE */
            flex-basis: 260px;    /* Mida base ideal */
            max-width: 300px;     /* PROHIBIT CRÉIXER MÉS ENLLÀ D'AIXÒ */
        }
        
        .file-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .card-image {
            width: 100%;
            height: 120px;
            background-color: #e9ecef;
            background-size: cover;
            background-position: center;
        }
        
        .card-image-placeholder { display: flex; align-items: center; justify-content: center; font-size: 3em; color: #adb5bd; height: 100%; }
        .card-body { padding: 12px; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 14px; color: #495057; }
        .card-body h4 { font-family: 'VT323', monospace, sans-serif; font-size: 20px; margin: 0 0 8px 0; color: #212529; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-body p { margin: 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; }
        .window .content.document-view { padding: 40px 50px; font-family: "Times New Roman", Times, serif; line-height: 1.7; color: #222; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); overflow-y: auto; }
        .document-view * { max-width: 100%; } .document-view img { height: auto; border: 1px solid #ccc; padding: 3px; background: #fff; margin: 10px 0; } .document-view h1 { font-family: 'VT323', monospace, sans-serif; font-size: 28px; margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid #ccc; color: #000; } .document-view p { white-space: normal; text-align: left; } .document-view a { color: #0000ff; text-decoration: underline; } .document-view a:hover { color: #ff0000; } .document-view .date { font-style: italic; color: #666; font-size: 0.9em; margin-bottom: 20px; display: block; text-align: right; } .document-view ul, .document-view ol { padding-left: 40px; } .document-view li { margin-bottom: 10px; }
        .search-bar-container { width: 100%; padding: 8px 10px; border-bottom: 2px solid #f0f0f0; box-sizing: border-box; background-color: #f8f9fa; }
        .search-input { width: 100%; padding: 8px; font-size: 16px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
    </style>

    <!-- ÚNICA ADDICIÓ AL HEAD: CSS de la llibreria Clippy.js -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/pi0/clippyjs/assets/clippy.css">
</head>
<body>

    <div id="menu-bar"><span><b>El Meu Portafolis</b> v3.1</span></div>
    <div id="desktop">
        <div id="desktop-icons">
            <div class="icon" id="icon-readme" tabindex="0"><img src="file.png" alt="Arxiu Llegeix-me"><span>Llegeix-me.txt</span></div>
            <div class="icon" id="icon-projects" tabindex="0"><img src="carpeta.png" alt="Carpeta de Projectes"><span>Projectes</span></div>
            <div class="icon" id="icon-apps" tabindex="0"><img src="carpeta.png" alt="Carpeta d'Apps"><span>Apps</span></div>
            <div class="icon" id="icon-blog" tabindex="0"><img src="carpeta.png" alt="Arxiu de Bloc"><span>Bloc</span></div>
        </div>
    </div>
    <div id="taskbar"><div id="start-button">Inici</div><div id="clock"></div></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let zIndexCounter = 10;
            const desktop = document.getElementById('desktop');
            let dataCache = null;
            let windowCascadeCount = 0;

            const welcomeContentHTML = `
                <h1>Benvingut/da al meu Portafolis Interactiu!</h1>
                <p>Hola! Soc <strong>[El Teu Nom]</strong>, un/a desenvolupador/a i entusiasta de la tecnologia amb ganes de crear experiències úniques.</p>
                <p>Aquesta web simula un escriptori d'un sistema operatiu clàssic. Està dissenyada per ser una forma original i divertida de mostrar els meus treballs. Aquí tens una petita guia per començar a explorar:</p>
                <ul>
                    <li><b>Navega per les carpetes:</b> Fes doble clic a les icones de l'escriptori ("Projectes", "Apps", "Bloc") per obrir-les i veure què contenen. Dins veuràs targetes amb imatges i resums.</li>
                    <li><b>Obre els arxius:</b> Un cop dins d'una carpeta, fes doble clic sobre qualsevol targeta per llegir el contingut complet en una nova finestra.</li>
                    <li><b>Gestiona el teu espai:</b> Pots arrossegar les finestres per organitzar l'escriptori. També pots redimensionar-les des de qualsevol costat o cantonada.</li>
                    <li><b>Cerca Global:</b> A dins de cada carpeta, trobaràs una barra de cerca per filtrar els arxius ràpidament.</li>
                </ul>
                <p>Espero que gaudeixis de l'experiència. Endavant, explora sense por!</p>
            `;

            const fetchData = async () => {
                if (dataCache) return dataCache;
                const response = await fetch('/api/data/all');
                dataCache = await response.json();
                return dataCache;
            };
            
            const createWindow = (id, title, contentHTML, options = {}) => {
                const existingWindow = document.getElementById(id);
                if (existingWindow) { existingWindow.style.zIndex = zIndexCounter++; return; }
                const win = document.createElement('div');
                win.id = id; win.className = 'window';
                const winWidth = parseInt(options.width || '600px', 10);
                const winHeight = parseInt(options.height || '450px', 10);
                win.style.width = `${winWidth}px`; win.style.height = `${winHeight}px`;
                if (options.pos?.left && options.pos?.top) { win.style.left = options.pos.left; win.style.top = options.pos.top; } else {
                    const desktopWidth = desktop.offsetWidth; const desktopHeight = desktop.offsetHeight; const offset = (windowCascadeCount % 10) * 30;
                    let left = 20 + offset; let top = 20 + offset;
                    if (left + winWidth > desktopWidth) left = Math.max(10, desktopWidth - winWidth - 20);
                    if (top + winHeight > desktopHeight) top = Math.max(10, desktopHeight - winHeight - 20);
                    win.style.left = `${left}px`; win.style.top = `${top}px`;
                    windowCascadeCount++;
                }
                win.style.zIndex = zIndexCounter++;
                win.innerHTML = `<div class="title-bar"><span class="title">${title}</span><div class="title-bar-buttons"><button class="close-btn">x</button></div></div><div class="content ${options.contentClass || ''}">${contentHTML}</div><div class="resizer n"></div><div class="resizer s"></div><div class="resizer e"></div><div class="resizer w"></div><div class="resizer ne"></div><div class="resizer nw"></div><div class="resizer se"></div><div class="resizer sw"></div>`;
                desktop.appendChild(win);
                makeDraggable(win); makeResizable(win); 
                win.querySelector('.close-btn').addEventListener('click', () => win.remove());
                win.addEventListener('mousedown', () => win.style.zIndex = zIndexCounter++);
                if (options.isFolder) { win.querySelector('.files-container').addEventListener('dblclick', handleOpenFile); }
            };
            const handleOpenFile = async (event) => {
                const fileCard = event.target.closest('.file-card'); if (!fileCard) return;
                const { type, id } = fileCard.dataset; const numericId = parseInt(id, 10);
                const data = await fetchData();
                const arrayName = type === 'blog' ? 'blog' : type + 's';
                const item = data[arrayName].find(d => d.id === numericId);
                if (!item) { console.error("No s'ha trobat l'element:", type, id); return; }
                let fileContentHTML = ''; let fileTitle = `${item.title}.txt`; let windowOptions = { contentClass: 'document-view' };
                if (type === 'project' || type === 'app') { fileContentHTML = item.description; } else if (type === 'blog') {
                    fileContentHTML = `<h1>${item.title}</h1><div class="date">${new Date(item.date).toLocaleDateString()}</div>${item.content}`;
                    windowOptions.width = '700px'; windowOptions.height = '840px';
                }
                createWindow(`window-${type}-${id}`, fileTitle, fileContentHTML, windowOptions);
            };
            const stripHtml = (html) => { let tmp = document.createElement("DIV"); tmp.innerHTML = html; return tmp.textContent || tmp.innerText || ""; }
            const createFolderWindow = async (type, windowTitle) => {
                const data = await fetchData(); 
                const items = data[getPluralType(type)] || [];
                let filesHTML = '';
                items.forEach(item => {
                    const snippet = stripHtml(item.description || item.content).substring(0, 100);
                    const imageStyle = item.imageUrl ? `background-image: url('${item.imageUrl}')` : '';
                    const imagePlaceholder = !item.imageUrl ? '<div class="card-image-placeholder">🖼️</div>' : '';
                    filesHTML += `<div class="file-card" data-type="${type}" data-id="${item.id}"><div class="card-image" style="${imageStyle}">${imagePlaceholder}</div><div class="card-body"><h4>${item.title}</h4><p>${snippet}...</p></div></div>`;
                });
                const content = `<div class="search-bar-container"><input type="text" id="${type}-search-input" class="search-input" placeholder="Cerca..."></div><div class="files-container" id="${type}-files-container">${filesHTML}</div>`;
                
                createWindow(`window-${getPluralType(type)}`, windowTitle, content, { isFolder: true, contentClass: 'folder-view', width: '850px', height: '550px' });
                document.getElementById(`${type}-search-input`).addEventListener('input', (event) => handleSearch(event, type));
            };
            document.getElementById('icon-projects').addEventListener('dblclick', () => createFolderWindow('project', 'Projectes'));
            document.getElementById('icon-apps').addEventListener('dblclick', () => createFolderWindow('app', 'Aplicacions'));
            document.getElementById('icon-blog').addEventListener('dblclick', () => createFolderWindow('blog', 'Bloc'));
            document.getElementById('icon-readme').addEventListener('dblclick', () => showWelcomeWindow());
            const getPluralType = (type) => type === 'blog' ? type : type + 's';
            const handleSearch = (event, type) => {
                const query = event.target.value.toLowerCase().trim();
                const containerId = `${type}-files-container`;
                const allFiles = document.querySelectorAll(`#${containerId} .file-card`);
                const items = dataCache[getPluralType(type)];
                
                allFiles.forEach(fileCard => {
                    const id = parseInt(fileCard.dataset.id, 10); 
                    const item = items.find(i => i.id === id); 
                    if (!item) return;
                    
                    const searchableText = stripHtml(`${item.title} ${item.description || item.content} ${item.date || ''}`).toLowerCase();
                    fileCard.style.display = searchableText.includes(query) ? '' : 'none';
                });
            };
            const makeDraggable = (element) => { let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0; const header = element.querySelector('.title-bar'); if (header) header.onmousedown = dragMouseDown; function dragMouseDown(e) { e.preventDefault(); pos3 = e.clientX; pos4 = e.clientY; document.onmouseup = closeDragElement; document.onmousemove = elementDrag; } function elementDrag(e) { e.preventDefault(); pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY; pos3 = e.clientX; pos4 = e.clientY; element.style.top = (element.offsetTop - pos2) + "px"; element.style.left = (element.offsetLeft - pos1) + "px"; } function closeDragElement() { document.onmouseup = null; document.onmousemove = null; } };
            const makeResizable = (element) => { const resizers = element.querySelectorAll('.resizer'); const minimum_size = 200; let original_width = 0, original_height = 0, original_x = 0, original_y = 0; let original_mouse_x = 0, original_mouse_y = 0; resizers.forEach(resizer => { resizer.addEventListener('mousedown', (e) => { e.preventDefault(); original_width = parseFloat(getComputedStyle(element, null).getPropertyValue('width').replace('px', '')); original_height = parseFloat(getComputedStyle(element, null).getPropertyValue('height').replace('px', '')); original_x = element.getBoundingClientRect().left; original_y = element.getBoundingClientRect().top; original_mouse_x = e.pageX; original_mouse_y = e.pageY; window.addEventListener('mousemove', resize); window.addEventListener('mouseup', stopResize); function resize(e) { if (resizer.classList.contains('se')) { const width = original_width + (e.pageX - original_mouse_x); const height = original_height + (e.pageY - original_mouse_y); if (width > minimum_size) element.style.width = width + 'px'; if (height > minimum_size) element.style.height = height + 'px'; } else if (resizer.classList.contains('sw')) { const height = original_height + (e.pageY - original_mouse_y); const width = original_width - (e.pageX - original_mouse_x); if (height > minimum_size) element.style.height = height + 'px'; if (width > minimum_size) { element.style.width = width + 'px'; element.style.left = original_x + (e.pageX - original_mouse_x) + 'px'; } } else if (resizer.classList.contains('ne')) { const width = original_width + (e.pageX - original_mouse_x); const height = original_height - (e.pageY - original_mouse_y); if (width > minimum_size) element.style.width = width + 'px'; if (height > minimum_size) { element.style.height = height + 'px'; element.style.top = original_y + (e.pageY - original_mouse_y) + 'px'; } } else if (resizer.classList.contains('nw')) { const width = original_width - (e.pageX - original_mouse_x); const height = original_height - (e.pageY - original_mouse_y); if (width > minimum_size) { element.style.width = width + 'px'; element.style.left = original_x + (e.pageX - original_mouse_x) + 'px'; } if (height > minimum_size) { element.style.height = height + 'px'; element.style.top = original_y + (e.pageY - original_mouse_y) + 'px'; } } else if (resizer.classList.contains('n')) { const height = original_height - (e.pageY - original_mouse_y); if (height > minimum_size) { element.style.height = height + 'px'; element.style.top = original_y + (e.pageY - original_mouse_y) + 'px'; } } else if (resizer.classList.contains('s')) { const height = original_height + (e.pageY - original_mouse_y); if (height > minimum_size) element.style.height = height + 'px'; } else if (resizer.classList.contains('e')) { const width = original_width + (e.pageX - original_mouse_x); if (width > minimum_size) element.style.width = width + 'px'; } else if (resizer.classList.contains('w')) { const width = original_width - (e.pageX - original_mouse_x); if (width > minimum_size) { element.style.width = width + 'px'; element.style.left = original_x + (e.pageX - original_mouse_x) + 'px'; } } } function stopResize() { window.removeEventListener('mousemove', resize); } }); }); }
            document.querySelectorAll('.icon').forEach(icon => makeDraggable(icon));
            const updateClock = () => { const now = new Date(); const hours = String(now.getHours()).padStart(2, '0'); const minutes = String(now.getMinutes()).padStart(2, '0'); document.getElementById('clock').textContent = `${hours}:${minutes}`; }
            setInterval(updateClock, 1000); updateClock();
            const showWelcomeWindow = () => {
                const desktopWidth = desktop.offsetWidth; const desktopHeight = desktop.offsetHeight; let winWidth = 600; let winHeight = 500;
                if (winWidth > desktopWidth - 40) winWidth = desktopWidth - 40; if (winHeight > desktopHeight - 40) winHeight = desktopHeight - 40;
                const centerLeft = (desktopWidth / 2) - (winWidth / 2); const centerTop = (desktopHeight / 2) - (winHeight / 2);
                const options = { pos: {left: `${centerLeft}px`, top: `${centerTop}px`}, contentClass: 'document-view', width: `${winWidth}px`, height: `${winHeight}px` };
                createWindow('window-welcome', 'Benvinguda.txt', welcomeContentHTML, options);
            }
            fetchData();
            showWelcomeWindow();
        });
    </script>

    <!-- Llibreries per a Clippy (ARA SÍ) -->
<script src="https://unpkg.com/jquery@3.2.1"></script> <!-- jQuery és necessari -->
<script src="clippy.js"></script> <!-- El motor que hem descarregat -->
<script src="/agents/Clippy/sounds-ogg.js"></script>
<script src="/agents/Clippy/agent.js"></script>

<!-- Finalment, el nostre script de control -->
<script>
    // Li diem a la llibreria on trobar la carpeta 'agents'
    window.CLIPPY_CDN = '/agents/';

    clippy.load('Clippy', function(agent) {
        agent.moveTo(50, window.innerHeight - 150);
        agent.show();

        setTimeout(function() {
            agent.speak('Perdona la tardança! Tenia els papers desordenats.');
            agent.animate();
        }, 2000);

        function askClippy() {
    if (!window.clippyAgent) return;

    // 1. Creem l'HTML per a la caixa de text i el botó
    const inputHtml = `
        <div>Què t'agradaria saber?<br>
            <input type="text" id="clippy-prompt-input" style="width: 160px; margin-top: 5px; font-family: 'Microsoft Sans', sans-serif; font-size: 10pt;">
            <button id="clippy-prompt-button" style="font-family: 'Microsoft Sans', sans-serif; font-size: 10pt;">Enviar</button>
        </div>
    `;

    // 2. Li diem a en Clippy que "digui" aquest HTML. Això crearà el formulari dins del globus.
    window.clippyAgent.speak(inputHtml);

    // 3. IMPORTANT: Ara que l'HTML existeix a la pàgina, busquem el botó i la caixa de text per afegir-los funcionalitat.
    setTimeout(function() {
        const sendButton = document.getElementById('clippy-prompt-button');
        const inputField = document.getElementById('clippy-prompt-input');

        if (!sendButton || !inputField) return;

        // Posem el focus a la caixa de text
        inputField.focus();
        
        // 4. Aquesta funció s'executarà quan es premi el botó o la tecla Enter
        async function submitQuery() {
            const userPrompt = inputField.value;

            if (userPrompt && userPrompt.trim() !== '') {
                // Desactivem el botó per evitar múltiples clics
                sendButton.disabled = true;
                inputField.disabled = true;

                window.clippyAgent.animate();
                window.clippyAgent.speak('Un moment, estic pensant...');
                try {
                    const response = await fetch('/api/ask-clippy', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: userPrompt })
                    });
                    const data = await response.json();
                    window.clippyAgent.speak(data.reply);
                } catch (error) {
                    window.clippyAgent.speak('Vaja... alguna cosa ha anat malament.');
                } finally {
                    // En aquest cas no aturem l'agent, simplement parlarà i tornarà a idle.
                }
            } else {
                window.clippyAgent.speak("No has escrit res. Prova de nou!");
            }
        }

        // Assignem la funció a l'esdeveniment 'click' del botó
        sendButton.addEventListener('click', submitQuery);

        // Assignem la funció a l'esdeveniment 'keypress' per a la tecla Enter
        inputField.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                submitQuery();
            }
        });

    }, 100); // Donem un petit marge de 100ms perquè el globus es dibuixi
}

        // Listener per fer clic
        document.querySelector('body').addEventListener('click', function (e) {
            if (e.target.closest && e.target.closest('.clippy')) {
                askClippy();
            }
        });
    });
</script>

    <!-- ÚNIQUES ADDICIONS AL BODY: Llibreries per a Clippy -->
    <script src="https://cdn.jsdelivr.net/gh/pi0/clippyjs/assets/clippy.min.js"></script>
    <script src="clippy.js"></script>
</body>
</html>